<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="fw-bold text-center mb-4">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: –ó–∞–∫–∞–∑—ã</h2>
    <div id="adminContent" class="d-none">
      <div id="ordersList" class="row g-3"></div>
    </div>
    <div id="errorMessage" class="text-danger text-center fw-semibold"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module" src="firebase.js"></script>
  <script type="module" src="main.js"></script>
  <script>
    // üîß –í—Å—Ç–∞–≤—å —Å–≤–æ–π firebaseConfig –Ω–∏–∂–µ
    const db = firebase.firestore();

    const adminContent = document.getElementById("adminContent");
    const ordersList = document.getElementById("ordersList");
    const errorEl = document.getElementById("errorMessage");

    // üë§ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    auth.onAuthStateChanged(async user => {
      if (!user) {
        errorEl.textContent = "–í—ã –Ω–µ –≤–æ—à–ª–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.";
        return;
      }

      const roleDoc = await db.collection("roles").doc(user.uid).get();
      if (!roleDoc.exists || roleDoc.data().role !== "admin") {
        errorEl.textContent = "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.";
        return;
      }

      // –ï—Å–ª–∏ –∞–¥–º–∏–Ω ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
      adminContent.classList.remove("d-none");
      loadOrders();
    });

    // üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
    async function loadOrders() {
      try {
        const snapshot = await db.collection("orders").orderBy("createdAt", "desc").get();

        if (snapshot.empty) {
          ordersList.innerHTML = "<p class='text-center text-muted'>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>";
          return;
        }

        snapshot.forEach(doc => {
          const data = doc.data();
          const date = new Date(data.createdAt).toLocaleString();
          const itemsHtml = data.items.map(item =>
            `<li>${item.title} (${item.size}) ‚Äî ${item.quantity} —à—Ç. –ø–æ ‚ÇΩ${item.price}</li>`
          ).join("");

          ordersList.innerHTML += `
            <div class="col-12">
              <div class="border rounded p-3 bg-white shadow-sm">
                <h5 class="fw-bold mb-1">–ó–∞–∫–∞–∑ –æ—Ç ${data.email}</h5>
                <p class="mb-1 text-muted">–î–∞—Ç–∞: ${date}</p>
                <p class="mb-1">–°—É–º–º–∞: <strong>‚ÇΩ${data.total}</strong></p>
                <ul class="mb-0">${itemsHtml}</ul>
              </div>
            </div>
          `;
        });
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤:", err);
        errorEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤.";
      }
    }
  </script>

</body>
</html>